{
  "version": "7",
  "dialect": "sqlite",
  "id": "6d6e7f63-3132-43c8-80b8-cc49c5f7b0f9",
  "prevIds": [
    "00000000-0000-0000-0000-000000000000"
  ],
  "ddl": [
    {
      "name": "upload_copy_events",
      "entityType": "tables"
    },
    {
      "name": "uploads",
      "entityType": "tables"
    },
    {
      "type": "text",
      "notNull": false,
      "autoincrement": false,
      "default": null,
      "generated": null,
      "name": "id",
      "entityType": "columns",
      "table": "upload_copy_events"
    },
    {
      "type": "text",
      "notNull": true,
      "autoincrement": false,
      "default": null,
      "generated": null,
      "name": "upload_id",
      "entityType": "columns",
      "table": "upload_copy_events"
    },
    {
      "type": "text",
      "notNull": false,
      "autoincrement": false,
      "default": null,
      "generated": null,
      "name": "actor_user_id",
      "entityType": "columns",
      "table": "upload_copy_events"
    },
    {
      "type": "text",
      "notNull": true,
      "autoincrement": false,
      "default": null,
      "generated": null,
      "name": "copied_format",
      "entityType": "columns",
      "table": "upload_copy_events"
    },
    {
      "type": "text",
      "notNull": true,
      "autoincrement": false,
      "default": "CURRENT_TIMESTAMP",
      "generated": null,
      "name": "copied_at",
      "entityType": "columns",
      "table": "upload_copy_events"
    },
    {
      "type": "text",
      "notNull": true,
      "autoincrement": false,
      "default": null,
      "generated": null,
      "name": "source",
      "entityType": "columns",
      "table": "upload_copy_events"
    },
    {
      "type": "text",
      "notNull": false,
      "autoincrement": false,
      "default": null,
      "generated": null,
      "name": "id",
      "entityType": "columns",
      "table": "uploads"
    },
    {
      "type": "text",
      "notNull": false,
      "autoincrement": false,
      "default": null,
      "generated": null,
      "name": "owner_user_id",
      "entityType": "columns",
      "table": "uploads"
    },
    {
      "type": "text",
      "notNull": false,
      "autoincrement": false,
      "default": null,
      "generated": null,
      "name": "expires_at",
      "entityType": "columns",
      "table": "uploads"
    },
    {
      "type": "text",
      "notNull": true,
      "autoincrement": false,
      "default": null,
      "generated": null,
      "name": "r2_key",
      "entityType": "columns",
      "table": "uploads"
    },
    {
      "type": "text",
      "notNull": true,
      "autoincrement": false,
      "default": null,
      "generated": null,
      "name": "public_url",
      "entityType": "columns",
      "table": "uploads"
    },
    {
      "type": "text",
      "notNull": true,
      "autoincrement": false,
      "default": null,
      "generated": null,
      "name": "mime_type",
      "entityType": "columns",
      "table": "uploads"
    },
    {
      "type": "integer",
      "notNull": true,
      "autoincrement": false,
      "default": null,
      "generated": null,
      "name": "size_bytes",
      "entityType": "columns",
      "table": "uploads"
    },
    {
      "type": "text",
      "notNull": false,
      "autoincrement": false,
      "default": null,
      "generated": null,
      "name": "thumb_r2_key",
      "entityType": "columns",
      "table": "uploads"
    },
    {
      "type": "text",
      "notNull": false,
      "autoincrement": false,
      "default": null,
      "generated": null,
      "name": "webp_r2_key",
      "entityType": "columns",
      "table": "uploads"
    },
    {
      "type": "integer",
      "notNull": false,
      "autoincrement": false,
      "default": null,
      "generated": null,
      "name": "webp_size_bytes",
      "entityType": "columns",
      "table": "uploads"
    },
    {
      "type": "text",
      "notNull": true,
      "autoincrement": false,
      "default": "'pending'",
      "generated": null,
      "name": "optimization_status",
      "entityType": "columns",
      "table": "uploads"
    },
    {
      "type": "text",
      "notNull": false,
      "autoincrement": false,
      "default": null,
      "generated": null,
      "name": "optimized_at",
      "entityType": "columns",
      "table": "uploads"
    },
    {
      "type": "integer",
      "notNull": false,
      "autoincrement": false,
      "default": null,
      "generated": null,
      "name": "width",
      "entityType": "columns",
      "table": "uploads"
    },
    {
      "type": "integer",
      "notNull": false,
      "autoincrement": false,
      "default": null,
      "generated": null,
      "name": "height",
      "entityType": "columns",
      "table": "uploads"
    },
    {
      "type": "text",
      "notNull": false,
      "autoincrement": false,
      "default": null,
      "generated": null,
      "name": "sha256",
      "entityType": "columns",
      "table": "uploads"
    },
    {
      "type": "integer",
      "notNull": true,
      "autoincrement": false,
      "default": "0",
      "generated": null,
      "name": "copy_count",
      "entityType": "columns",
      "table": "uploads"
    },
    {
      "type": "text",
      "notNull": true,
      "autoincrement": false,
      "default": "CURRENT_TIMESTAMP",
      "generated": null,
      "name": "created_at",
      "entityType": "columns",
      "table": "uploads"
    },
    {
      "type": "text",
      "notNull": true,
      "autoincrement": false,
      "default": "CURRENT_TIMESTAMP",
      "generated": null,
      "name": "updated_at",
      "entityType": "columns",
      "table": "uploads"
    },
    {
      "type": "text",
      "notNull": false,
      "autoincrement": false,
      "default": null,
      "generated": null,
      "name": "deleted_at",
      "entityType": "columns",
      "table": "uploads"
    },
    {
      "columns": [
        "upload_id"
      ],
      "tableTo": "uploads",
      "columnsTo": [
        "id"
      ],
      "onUpdate": "NO ACTION",
      "onDelete": "CASCADE",
      "nameExplicit": false,
      "name": "fk_upload_copy_events_upload_id_uploads_id_fk",
      "entityType": "fks",
      "table": "upload_copy_events"
    },
    {
      "columns": [
        "id"
      ],
      "nameExplicit": false,
      "name": "upload_copy_events_pk",
      "table": "upload_copy_events",
      "entityType": "pks"
    },
    {
      "columns": [
        "id"
      ],
      "nameExplicit": false,
      "name": "uploads_pk",
      "table": "uploads",
      "entityType": "pks"
    },
    {
      "columns": [
        {
          "value": "upload_id",
          "isExpression": false
        },
        {
          "value": "copied_at",
          "isExpression": false
        }
      ],
      "isUnique": false,
      "where": null,
      "origin": "manual",
      "name": "idx_upload_copy_events_upload_copied_at",
      "entityType": "indexes",
      "table": "upload_copy_events"
    },
    {
      "columns": [
        {
          "value": "r2_key",
          "isExpression": false
        }
      ],
      "isUnique": true,
      "where": null,
      "origin": "manual",
      "name": "uploads_r2_key_unique",
      "entityType": "indexes",
      "table": "uploads"
    },
    {
      "columns": [
        {
          "value": "owner_user_id",
          "isExpression": false
        },
        {
          "value": "created_at",
          "isExpression": false
        }
      ],
      "isUnique": false,
      "where": null,
      "origin": "manual",
      "name": "idx_uploads_owner_created",
      "entityType": "indexes",
      "table": "uploads"
    },
    {
      "columns": [
        {
          "value": "created_at",
          "isExpression": false
        }
      ],
      "isUnique": false,
      "where": null,
      "origin": "manual",
      "name": "idx_uploads_created",
      "entityType": "indexes",
      "table": "uploads"
    },
    {
      "columns": [
        {
          "value": "expires_at",
          "isExpression": false
        }
      ],
      "isUnique": false,
      "where": "\"uploads\".\"expires_at\" IS NOT NULL",
      "origin": "manual",
      "name": "idx_uploads_expires_at",
      "entityType": "indexes",
      "table": "uploads"
    }
  ],
  "renames": []
}